{"componentChunkName":"component---src-templates-blog-post-jsx","path":"/blog/2018-04-09-jamstackなwebサイトの作成/","result":{"data":{"markdownRemark":{"excerpt":"新しくWebサイトを作成する機会があり、せっかくなので JAM Stack と呼ばれる手法で構築してみました。JAM Stackは、JS+API+Markupで構成されるサーバレスな枠組みです。 JAM Stack…","html":"<p>新しくWebサイトを作成する機会があり、せっかくなので <a href=\"https://jamstack.org/\">JAM Stack</a> と呼ばれる手法で構築してみました。JAM Stackは、JS+API+Markupで構成されるサーバレスな枠組みです。</p>\n<h2>JAM Stackとは</h2>\n<h3>特徴</h3>\n<ul>\n<li>フロントエンドがバックエンドから完全に分離されている</li>\n<li><a href=\"https://www.staticgen.com/\">Static Site Generator</a> を用いるなどして、事前に静的ファイル（HTML、JS）をビルドする</li>\n<li>画面描写は基本的にJSのみで行う</li>\n<li>ビルドしたファイルは全て CDN で配布する</li>\n<li>すべてのプロジェクトデータは Git 上で管理する</li>\n<li>Babel, PostCSS, Webpackなど最新のビルドツールを使う</li>\n<li>自動ビルド・自動デプロイ</li>\n<li>サーバサイドの機能が必要な時はAjaxでAPIをたたく</li>\n</ul>\n<h3>メリット</h3>\n<ul>\n<li>高パフォーマンス</li>\n<li>高セキュリティ</li>\n<li>スケーリングが容易で安価</li>\n<li>デベロッパフレンドリー</li>\n</ul>\n<h3>デメリット</h3>\n<ul>\n<li>クライアントとサーバが強く結びついているwebアプリには原則として適用できない</li>\n</ul>\n<h2>今回構築したWebサイトについて</h2>\n<h3>URL</h3>\n<p><a href=\"https://www.yuuniworks.com\" target=\"_blank\">https://www.yuuniworks.com</a>\n（<a href=\"https://github.com/junkboy0315/yuuni-web\" target=\"_blank\">ソースコード</a>）</p>\n<h3>構成図</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 500px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cc8c83772885665d168373b6dc1c9bf7/43304/20180409.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 108.13397129186603%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAACE3AAAhNwEzWJ96AAADIklEQVQ4y4VVS2sTURTOb9If0LWIbrrpxp0rV4Ig+IBaERHR0oVkU3CjWRSxXWShRWPbtGLpwxqSICTSvM2rzUwmz5k7uZ/n3OSmM0mDl1zOZM693/3OOd+5E3BdV5imKer1ujg/PxcA1MzncqLRaAgppbBtW1l+r+2MaQdoARzHgWk0oIdhGPiwtoaN9XWsrq5iZWUFwWAQ4XBY+QeDAWaMQcCyLGk7QtouyLqy025LIVxJjGW1WpUELs/OzmShUJAUgaRNkgfbicnDDTiOi45VR/zrK9itMggLlAXlpcPGR7fbbcVsiIWxHY0LQEHs/2bj2A7OoVePg/AhhMM70O/31cZmswlih06ncxmYH1BvatQK6k3ftomhq557vZ7yMTMGa7Va4/zNZMibeJi94UKbDpgE5NHpdGGYpvKpQ2h6wvcwdAT6RhWFjddwjRJszqEQU4AkBbQp9KlYh35PUejRTB3h590rsDPHcFhQjuMHpF8ok0W0WkOLWGbyBZxms4rxNEMKkQHqpwnYvTYRET6GSly0/k0sjY9/ishmTvHj8Ai/4glkcjlfDgl3mEP+12g5oGhhj4qiC6Hz2bJaqvLe0SU/NwWRumBIooZlVBDbfIGukSfZDHXIzKn11AFDQGvcJbq7uOokepaVHK0jHRJAvZTC9tsFWJU4WJdKhywhAtWJN6kgzii3XsnwmnK5LGmyHYbMoRmNurK2R4e8mP3cMZVKRU26SBSgBqUWRalUksy2VqsNAtwFDNKkHPEGBtVhdbtd5WNg3qDFrcHYx8xonywWi/w8CAiqKDNiywCcN7YqtIGc1Nsw87SeWesu8+lwUqijqim2scQJkr8TSCaTiMViaupC6XxqHY7S4AZ0PryTx+73KMLv9rC/FcPxyZECi0QiClwz9qz3M/QC6eY/ONzH9kYMBzsJRLa+YOvbDj5/2kQ6nZ66ZH2dMtmXeuHe7h6ev3yG+YV5XL95A3PXruL2nVso5Is+PU7dNlN3+AgwGo1ieXkZDx8/wuLSE9x/cA9LTxeRSqUu+wzMBvSGT58AhEIhlbfQ+5Cq/v/uw3+SNo3dZMndSAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"構成図\"\n        title=\"構成図\"\n        src=\"/static/cc8c83772885665d168373b6dc1c9bf7/d19c0/20180409.png\"\n        srcset=\"/static/cc8c83772885665d168373b6dc1c9bf7/6b181/20180409.png 125w,\n/static/cc8c83772885665d168373b6dc1c9bf7/5039d/20180409.png 250w,\n/static/cc8c83772885665d168373b6dc1c9bf7/d19c0/20180409.png 500w,\n/static/cc8c83772885665d168373b6dc1c9bf7/35c67/20180409.png 750w,\n/static/cc8c83772885665d168373b6dc1c9bf7/e11df/20180409.png 1000w,\n/static/cc8c83772885665d168373b6dc1c9bf7/43304/20180409.png 1463w\"\n        sizes=\"(max-width: 500px) 100vw, 500px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3>特徴</h3>\n<p>標準的な JAM Stack の構成に加え、下記の二つの機能を追加しています。</p>\n<ul>\n<li>Netlify CMS による GUI を用いたコンテンツ編集機能</li>\n<li>問合せメール送信機能（API側はAWS API Gateway+Lambda+SESで実装）</li>\n</ul>\n<h3>使用したソフトウェア・サービス等</h3>\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>React</td>\n<td>UI</td>\n</tr>\n<tr>\n<td>Gatsby</td>\n<td>Static Site Generator</td>\n</tr>\n<tr>\n<td>AWS(API, Lambda, SES)</td>\n<td>問合せメール送信用API</td>\n</tr>\n<tr>\n<td>Netlify</td>\n<td>CI/CD</td>\n</tr>\n<tr>\n<td>NetlifyCMS</td>\n<td>CMS</td>\n</tr>\n</tbody>\n</table>\n<h3>Gatsbyのプラグイン</h3>\n<p>Gatsbyでは、Webサイトでよく使われる機能について、あらかじめプラグインが用意されています。これをうまく使用することで、車輪の再発明をしなくてよい設計になっています。今回は、下記のプラグインを使用しました。</p>\n<h4>gatsby-plugin-glamor</h4>\n<p>下記のような、css-in-jsを使えるようにする。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">&lt;</span>div css<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n  marginHeight<span class=\"token operator\">:</span> <span class=\"token string\">'1rem'</span><span class=\"token punctuation\">,</span>\n  display<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>isVisible <span class=\"token operator\">?</span> <span class=\"token string\">'block'</span> <span class=\"token operator\">:</span> <span class=\"token string\">'none'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span></code></pre></div>\n<h4>gatsby-plugin-react-helmet</h4>\n<p>react-helmetに記載した内容を、自動でサーバサイドレンダリングする（JSをレンダリングできないクローラーのためのSEO対策）。</p>\n<h4>gatsby-plugin-feed</h4>\n<p>ブログ等のrssを自動生成する。</p>\n<h4>gatsby-plugin-google-analytics</h4>\n<p>google analytics用コードを自動で設置する。</p>\n<h4>gatsby-plugin-google-tagmanager</h4>\n<p>google tag manager用コードを自動で設置する。</p>\n<h4>gatsby-plugin-sentry</h4>\n<p><a href=\"https://sentry.io/welcome/\">Sentry</a> (クライアント側エラーのログ管理)用コードを自動で設置する。</p>\n<h4>gatsby-plugin-sitemap</h4>\n<p>サイトマップを自動生成する。</p>\n<h4>gatsby-plugin-typography</h4>\n<p>グローバルCSSを美しく設定する。</p>\n<h4>gatsby-remark-prismjs</h4>\n<p>markdownファイル内のコード記述部を装飾して表示する。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> description <span class=\"token operator\">=</span> <span class=\"token string\">'こんな感じです。'</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'多くの言語に対応してます。'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h4>gatsby-remark-images</h4>\n<p>markdownファイルにある画像を検出し、解像度の異なる画像を自動生成するなど、自動で最適化する。</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span>\n  <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/static/20180409-cc8c83772885665d168373b6dc1c9bf7-2f183.png<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">srcset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>\n    /static/20180409-cc8c83772885665d168373b6dc1c9bf7-67829.png 125w,\n    /static/20180409-cc8c83772885665d168373b6dc1c9bf7-5c59f.png 250w,\n    /static/20180409-cc8c83772885665d168373b6dc1c9bf7-2f183.png 500w,\n    /static/20180409-cc8c83772885665d168373b6dc1c9bf7-c93e8.png 750w,\n    /static/20180409-cc8c83772885665d168373b6dc1c9bf7-4e628.png 1000w,\n    /static/20180409-cc8c83772885665d168373b6dc1c9bf7-9260f.png 1463w<span class=\"token punctuation\">\"</span></span>\n <span class=\"token attr-name\">sizes</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>(max-width: 500px) 100vw, 500px<span class=\"token punctuation\">\"</span></span>\n<span class=\"token punctuation\">/></span></span></code></pre></div>\n<h4>gatsby-remark-relative-images</h4>\n<p>前述のgatsby-remark-imagesは、画像リンクが相対パスでないと機能しない。NetlifyCMSでアップした画像は必ず絶対パスになってしまうため、画像が最適化されない。この問題を解消するため、このプラグインを使ってあらかじめ絶対パスを相対パスに書き換える。</p>\n<h2>所感</h2>\n<ul>\n<li>コストがかからない</li>\n<li>サーバ性能を気にしなくてよい</li>\n<li>すべてが速い</li>\n<li>はじめからグローバルを前提とした設計である</li>\n</ul>\n<p>など、多くの点に強い魅力を感じました。</p>\n<p>ドキュメントサイトや、サーバサイドにそれほど複雑な機能を必要としないコーポレートサイトなどには適した手法だと思います。</p>\n<p>なにより、<code class=\"language-text\">git push</code> だけで世界中のCDNに静的ファイルが配置でき、開発者に優しくてよいです。そのうえ、今回のようにCMSを入れれば、ユーザに優しいGUIを使ってコンテンツを更新することもできます。</p>\n<p>JAM Stack、今後、日本でも採用が増えていくと思います。</p>\n<h2>参考</h2>\n<ul>\n<li><a href=\"https://www.gatsbyjs.org/tutorial/\">Gatsbyの使い方</a></li>\n<li><a href=\"https://www.netlify.com/blog/2016/02/24/a-step-by-step-guide-gatsby-on-netlify/\">NetlifyでCI/CD環境を構築する方法</a></li>\n<li><a href=\"https://www.netlifycms.org/docs/add-to-your-site/\">Netlify CMSのGatsbyへの実装方法</a></li>\n<li><a href=\"https://blog.craftz.dog/aws-lambda%E3%81%A7%E9%9D%99%E7%9A%84%E3%82%B5%E3%82%A4%E3%83%88%E3%81%AB%E3%83%A1%E3%83%BC%E3%83%AB%E9%80%81%E4%BF%A1%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0%E3%82%92%E4%BD%9C%E3%82%8B%E7%B0%A1%E5%8D%98%E3%81%AA%E6%96%B9%E6%B3%95-de8cba5e50a5\">AWS Lambdaで静的サイトにメール送信フォームを作る簡単な方法</a></li>\n</ul>","fields":{"slug":"/2018-04-09-jamstackなwebサイトの作成/"},"frontmatter":{"title":"JAM StackなWebサイトの作成","summary":"JS+API+Markupで構成されるサーバレスな枠組みで、自社のWebサイトを構築してみました。","date":"2018-04-09T15:00:00+09:00","dateModified":"2018-04-18T23:00:00+09:00","thumbnail":"/blogImages/20180409.png"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2018-04-09-jamstackなwebサイトの作成/","modifiedDate":"2018-04-18T23:00:00+09:00"}}}
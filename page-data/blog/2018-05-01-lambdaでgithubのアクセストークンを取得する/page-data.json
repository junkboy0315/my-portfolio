{"componentChunkName":"component---src-templates-blog-post-jsx","path":"/blog/2018-05-01-lambdaでgithubのアクセストークンを取得する/","result":{"data":{"markdownRemark":{"excerpt":"アクセストークンの取得 OAuthをWebアプリに実装する際、まずアクセストークンを取得する必要があります。 GoogleやFacebookの場合、SDKを使ってフロントエンド側だけで取得できます。\n下記のような便利なコンポーネントもあり、頻繁に更新されています。 react…","html":"<h2>アクセストークンの取得</h2>\n<p>OAuthをWebアプリに実装する際、まずアクセストークンを取得する必要があります。</p>\n<p>GoogleやFacebookの場合、SDKを使ってフロントエンド側だけで取得できます。\n下記のような便利なコンポーネントもあり、頻繁に更新されています。</p>\n<ul>\n<li><a href=\"https://github.com/anthonyjgrove/react-google-login\">react-google-login</a></li>\n<li><a href=\"https://github.com/keppelen/react-facebook-login\">react-facebook-login</a></li>\n</ul>\n<p>ところが、Githubの場合はフロントエンド側だけではトークンを取得できません。\nサーバが存在することを前提に認証を行う枠組みになっているためです。</p>\n<h2>GithubのOAuth認証の動き</h2>\n<p>Githubの場合は、認証画面からリダイレクトで戻ってきたとき、トークンではなく<code class=\"language-text\">code</code>というものを渡されます。\n基本的には、この<code class=\"language-text\">code</code>を下記のAPIにPOSTしてやれば、トークンが取得できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">POST https://github.com/login/oauth/access_token</code></pre></div>\n<p>ところが、このエンドポイントにはCORSが設定されていないため、フロントエンドから取得するとエラーがでます。</p>\n<p>サーバ側で<code class=\"language-text\">code</code>をトークンと交換する処理をしなさい、ということなのでしょう。\nしかし、Webアプリをサーバレスで運用している場合は、トークンが取得できないということになります。\nバッドノウハウで無理矢理取得できないこともないのですが、美しくありません。</p>\n<h2>Lambdaでアクセストークンを取得</h2>\n<p>この問題を解決するため、今回はLambda Functionを作成して対応しました。</p>\n<ul>\n<li><a href=\"https://github.com/junkboy0315/github-token-getter\">github-token-getter</a></li>\n</ul>\n<p>Githubから受けとった<code class=\"language-text\">code</code>をparamに付与してGETを叩けば、トークンが返ってくるという単純なものです。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 500px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dc9437b632f796fbfeb2705bc948048d/e98d7/20180501.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 83.43949044585986%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAACE3AAAhNwEzWJ96AAAB30lEQVQ4y4VTTW7iMBjNGTgSZ+IO7FhxBVZ0gRCsZlEhEAdA7YIOIDQiaVIISew4/k08rzEFymTUp8ixk+99732fbc9aq5SSUhpjtNa+7282m4yQQ+D/ORxOcYwnjKIwDIMgiKII8WWNqqo8cPBar9fT6XSxWOAfEpE0tbqspLZSWS4/R2sRab/Dgxpeg8Gg2+32+30hBESi4D3/OGVBRI9xEoSKsteXl6fhcLlc/qoxn89Xq5Xn8vV6vVar1W63MSeE+OF7zLIjTTFSlnMhfr+9zZ6fZ7PZaDSaTCbD4RBOL2Sswex0Os52kibMyEJLUarqyySqe7R9v4BnyNomgImkjLEsy649u5G1UpRS8F0oVO6FYBC/3KY0KCOTVIpz/q89Vwt21KW+kUvKZJqplOiU0vBDcO4HflyQTLGzoKb81KlshaSyxsVXLeBBzhS8FBKPoHlRFEmScCOFUbLUl4q0dswHU98apuvCYM8F0YyE5yM1/MwJUyI+nfb7/W63y/Pc+fceasNXOET9mGNCCyaMzgUrpAAHHXUjDDaQ4c119bqxqgY+/rDPTi1N0/s4LN3Nubbq1rDGI4EOHWuAifk1+gdlF4SGozFwgdtm/49mZfjEBRqPx9vttvFUO/wFqA3I8uzJuN4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Lambdaを使ったGithubのOAuthの流れ\"\n        title=\"Lambdaを使ったGithubのOAuthの流れ\"\n        src=\"/static/dc9437b632f796fbfeb2705bc948048d/d19c0/20180501.png\"\n        srcset=\"/static/dc9437b632f796fbfeb2705bc948048d/6b181/20180501.png 125w,\n/static/dc9437b632f796fbfeb2705bc948048d/5039d/20180501.png 250w,\n/static/dc9437b632f796fbfeb2705bc948048d/d19c0/20180501.png 500w,\n/static/dc9437b632f796fbfeb2705bc948048d/35c67/20180501.png 750w,\n/static/dc9437b632f796fbfeb2705bc948048d/e11df/20180501.png 1000w,\n/static/dc9437b632f796fbfeb2705bc948048d/e98d7/20180501.png 1413w\"\n        sizes=\"(max-width: 500px) 100vw, 500px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>叩く</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">GET https://your.api.gateway/getToken?code=CODE_FROM_GITHUB</code></pre></div>\n<p>トークン帰ってくる</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{ &quot;accessToken&quot;: &quot;a1b2c3........&quot; }</code></pre></div>\n<p>なお、CODEを取得するまでの処理は、下記のコンポーネントを使うと便利です。</p>\n<ul>\n<li><a href=\"https://github.com/checkr/react-github-login\">react-github-login</a></li>\n</ul>\n<h2>参考</h2>\n<ul>\n<li><a href=\"https://developer.github.com/apps/building-oauth-apps/authorization-options-for-oauth-apps/#web-application-flow\">(Github) Authorization options for OAuth Apps</a></li>\n</ul>","fields":{"slug":"/2018-05-01-lambdaでgithubのアクセストークンを取得する/"},"frontmatter":{"title":"LambdaでGithubのアクセストークンを取得する","summary":"サーバレス環境でGithubのアクセストークンを取得するために、Lambdaを活用しました。","date":"2018-05-01T19:03:56+09:00","dateModified":"2018-05-01T19:03:56+09:00","thumbnail":"/blogImages/20180501.png"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2018-05-01-lambdaでgithubのアクセストークンを取得する/","modifiedDate":"2018-05-01T19:03:56+09:00"}}}